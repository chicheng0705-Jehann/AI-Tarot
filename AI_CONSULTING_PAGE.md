# AI咨询页功能实现

## ✨ 功能概述

将底部AI Tab改造成一个多功能的AI咨询入口页面，支持多种咨询模式和智能匹配功能。

---

## 🎯 核心功能

### 1. 多模式咨询 ✅

**支持的模式：**
- ✅ **自动匹配**：小精灵自动选择最合适的解答方式
- ✅ **塔罗占卜**：直接使用塔罗牌解读
- ⏳ **星盘咨询**：敬请期待
- ⏳ **八字咨询**：敬请期待

**模式切换：**
- 右上角模式选择器
- 点击展开下拉菜单
- 选择不同模式，UI自动更新

---

### 2. 动态UI更新 ✅

**根据模式改变UI元素：**

| 模式 | 标题 | 头像 | 副标题 |
|------|------|------|--------|
| 自动匹配 | 准了小精灵 | 🧚 | 写下问题，小精灵会用最合适的方式... |
| 塔罗占卜 | 准了塔罗师 | 🔮 | 帮你解答/常见问题/答疑解惑... |
| 星盘咨询 | 准了星盘师 | ⭐ | 通过星盘为你解答关于命运... |
| 八字咨询 | 准了八字师 | ☯ | 通过八字为你预测未来... |

---

### 3. 热门问题浮层 ✅

**交互流程：**
```
点击"热门提问"按钮
  ↓
展开底部浮层（动画效果）
  ↓
显示热门问题列表
  ↓
点击任一问题
  ↓
问题自动填充到输入框（不提交）
  ↓
浮层关闭
```

**特点：**
- 动画效果：从底部滑出
- 点击遮罩关闭
- 点击问题自动填充
- 不自动提交，用户可编辑

---

### 4. 塔罗占卜模式 ✅

**交互流程：**
```
选择"塔罗占卜"模式
  ↓
UI更新为塔罗师
  ↓
用户输入问题并点击"问询"
  ↓
跳转到塔罗对话框（chat.html）
  ↓
自动提交问题（mode=auto_submit）
  ↓
后续流程：匹配牌阵 → 抽牌 → 解读
```

**关键参数：**
- URL参数：`question=xxx&mode=auto_submit`
- 进入对话框后自动提交问题
- 后续流程与之前保持一致

---

### 5. 自动匹配模式 ✅

**交互流程：**
```
选择"自动匹配"模式（默认）
  ↓
用户输入问题并点击"问询"
  ↓
显示加载动画："小精灵思考中..."
  ↓
2秒后显示匹配结果面板
  ↓
展示推荐的解答方式（塔罗占卜）
  ↓
用户点击"去咨询塔罗师"
  ↓
跳转到塔罗对话框并自动提交问题
```

**加载动画特效：**
- 小精灵头像脉冲动画
- 文字"小精灵思考中"
- 后面有动态点点点（...）

**匹配结果面板：**
- 中央弹窗
- 显示匹配的方式（塔罗占卜卡片）
- 两个按钮："换个方式" | "去咨询塔罗师"

---

### 6. 历史记录功能 ⏳

**位置：**
- 右上角时钟按钮

**状态：**
- 功能开发中
- 点击提示："功能开放中，敬请期待"

---

## 📂 文件修改

### 1. frontend/ai-reading.html

**主要改动：**
- ✅ 添加模式选择器（右上角）
- ✅ 添加时钟按钮（历史记录）
- ✅ 添加模式下拉菜单
- ✅ 动态头像和标题（通过ID可更新）
- ✅ 添加"热门提问"按钮
- ✅ 添加热门问题浮层

**HTML结构：**
```html
<div class="navbar">
  <div class="navbar-back">‹</div>
  <div class="navbar-title" id="navTitle">准了小精灵</div>
  <div class="navbar-actions">
    <div class="mode-selector">...</div>
    <button class="btn-history">🕐</button>
  </div>
</div>

<div class="mode-menu">...</div>

<div class="ai-avatar-section">
  <div class="ai-large-avatar" id="aiAvatar">
    <span id="avatarEmoji">🧚</span>
  </div>
  <h2 id="aiName">准了小精灵</h2>
  <p id="aiSubtitle">...</p>
</div>

<div class="hot-questions-overlay">...</div>
```

---

### 2. frontend/js/ai-reading.js

**核心函数：**

1. **`selectMode(mode)`** - 选择咨询模式
   - 更新UI（标题、头像、副标题）
   - 星盘和八字模式提示"敬请期待"
   
2. **`toggleHotQuestions()`** - 打开热门问题浮层
   - 首次打开时加载数据
   - 添加显示动画

3. **`selectHotQuestion(question)`** - 选择热门问题
   - 填充到输入框
   - 关闭浮层
   - 不自动提交

4. **`handleSubmit()`** - 处理提交
   - 塔罗模式：直接跳转并自动提交
   - 自动匹配模式：显示匹配流程

5. **`showAutoMatchResult(question)`** - 显示自动匹配结果
   - 显示加载动画（2秒）
   - 显示匹配结果面板

6. **`confirmMatchResult(question)`** - 确认匹配结果
   - 跳转到塔罗对话框
   - 自动提交问题

**状态变量：**
```javascript
let currentMode = 'auto'; // auto, tarot, astro, bazi

const modeConfig = {
  auto: { title, emoji, subtitle },
  tarot: { title, emoji, subtitle },
  ...
};
```

---

### 3. frontend/css/ai-reading.css

**新增样式：**

1. **导航栏样式**
   - `.navbar-actions` - 右侧按钮组
   - `.mode-selector` - 模式选择器
   - `.btn-history` - 时钟按钮

2. **模式菜单**
   - `.mode-menu` - 下拉菜单容器
   - `.mode-option` - 菜单选项
   - `.badge-coming` - "敬请期待"徽章

3. **热门问题浮层**
   - `.hot-questions-overlay` - 遮罩层
   - `.hot-questions-panel` - 面板（从底部滑出）
   - `.question-item` - 问题列表项

4. **自动匹配加载**
   - `.auto-match-overlay` - 加载遮罩
   - `.loading-avatar` - 头像脉冲动画
   - `.dots` - 点点点动画

5. **匹配结果面板**
   - `.match-result-overlay` - 遮罩
   - `.match-result-panel` - 面板（缩放动画）
   - `.result-card` - 推荐方式卡片

**动画效果：**
```css
@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

@keyframes dots {
  0%, 20% { content: ''; }
  40% { content: '.'; }
  60% { content: '..'; }
  80%, 100% { content: '...'; }
}
```

---

### 4. frontend/js/chat.js

**新增功能：**

**auto_submit模式支持：**
```javascript
if (mode === 'auto_submit') {
  setTimeout(() => {
    const input = document.getElementById('chatInput');
    if (input) {
      input.value = question;
    }
    sendUserMessage(question);
  }, 800);
}
```

**支持的模式：**
- `prefill` - 只填充，不提交
- `auto_submit` - 填充并自动提交

---

## 🎬 交互流程演示

### 流程1：塔罗占卜模式
```
1. 点击底部AI Tab
   ↓
2. 进入AI咨询页（默认：自动匹配）
   ↓
3. 点击右上角"自动匹配"
   ↓
4. 选择"塔罗占卜"
   ↓
5. UI更新：
   - 标题：准了塔罗师
   - 头像：🔮
   - 副标题：帮你解答/常见问题...
   ↓
6. 输入问题："我的财运如何"
   ↓
7. 点击"问询"
   ↓
8. 跳转到塔罗对话框
   ↓
9. 自动提交问题
   ↓
10. 后续流程：匹配牌阵 → 抽牌 → 解读
```

### 流程2：自动匹配模式
```
1. 点击底部AI Tab
   ↓
2. 进入AI咨询页（默认：自动匹配）
   ↓
3. 输入问题："我的财运如何"
   ↓
4. 点击"问询"
   ↓
5. 显示加载动画：
   - 小精灵头像（脉冲）
   - "小精灵思考中..."
   ↓
6. 2秒后显示匹配结果：
   - "已为你自动匹配最适合的解答方式"
   - 推荐：塔罗占卜
   ↓
7. 点击"去咨询塔罗师"
   ↓
8. 跳转到塔罗对话框
   ↓
9. 自动提交问题
   ↓
10. 后续流程：匹配牌阵 → 抽牌 → 解读
```

### 流程3：热门问题
```
1. 进入AI咨询页
   ↓
2. 点击"热门提问"按钮
   ↓
3. 浮层从底部滑出（动画）
   ↓
4. 显示热门问题列表
   ↓
5. 点击任一问题
   ↓
6. 问题填充到输入框
   ↓
7. 浮层关闭
   ↓
8. 用户可编辑问题
   ↓
9. 点击"问询"提交
```

---

## 🧪 测试场景

### 测试1：模式切换
```
1. 进入AI咨询页
2. 点击右上角"自动匹配"
3. ✅ 下拉菜单展开
4. 点击"塔罗占卜"
5. ✅ 标题变为"准了塔罗师"
6. ✅ 头像变为🔮
7. ✅ 副标题更新
8. ✅ 菜单关闭
```

### 测试2：未开放功能
```
1. 点击"星盘咨询"
2. ✅ 提示"功能开放中，敬请期待"
3. ✅ 菜单关闭
4. 点击右上角时钟按钮
5. ✅ 提示"功能开放中，敬请期待"
```

### 测试3：热门问题
```
1. 点击"热门提问"
2. ✅ 浮层从底部滑出
3. ✅ 显示问题列表
4. 点击"我有哪些财富机遇？"
5. ✅ 问题填充到输入框
6. ✅ 浮层关闭
7. ✅ 可以编辑问题
```

### 测试4：塔罗模式提交
```
1. 选择"塔罗占卜"模式
2. 输入"我的财运如何"
3. 点击"问询"
4. ✅ 跳转到对话框
5. ✅ 问题自动提交
6. ✅ AI开始匹配牌阵
```

### 测试5：自动匹配流程
```
1. 选择"自动匹配"模式（默认）
2. 输入"我的爱情如何"
3. 点击"问询"
4. ✅ 显示加载动画（小精灵脉冲）
5. ✅ "小精灵思考中..."（点点点动画）
6. 2秒后
7. ✅ 显示匹配结果面板
8. ✅ 推荐"塔罗占卜"
9. 点击"去咨询塔罗师"
10. ✅ 跳转到对话框
11. ✅ 问题自动提交
```

---

## 🎨 UI特点

### 1. 模式选择器
- 圆角按钮
- 下拉箭头图标
- 悬停效果：淡紫色背景
- 下拉菜单：白色卡片 + 阴影

### 2. 热门问题浮层
- 从底部滑出（transform动画）
- 遮罩层：半透明黑色
- 面板：白色圆角卡片
- 问题列表：带图标和箭头

### 3. 加载动画
- 小精灵头像脉冲（scale + opacity）
- 文字"小精灵思考中"
- 动态点点点（content动画）

### 4. 匹配结果面板
- 居中弹窗（缩放动画）
- 小精灵头像
- 标题+描述
- 推荐卡片（带图标）
- 两个按钮

---

## 🔑 关键参数

| 参数 | 值 | 说明 |
|------|------|------|
| 默认模式 | `auto` | 自动匹配 |
| 加载时间 | 2秒 | 自动匹配思考时间 |
| 自动提交延迟 | 800ms | 进入对话框后延迟 |
| 动画时长 | 0.3s | 浮层动画 |
| 脉冲周期 | 1.5s | 加载头像动画 |

---

**创建时间：** 2025-10-08  
**功能状态：** ✅ 已完成  
**测试状态：** 待验证

